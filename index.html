<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>دستیار صوتی پارسیان</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    body { background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%); }
    .glass-container { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border:1px solid rgba(255,255,255,0.2); }
    .audio-player { @apply flex items-center bg-white/20 backdrop-blur-md p-4 rounded-2xl shadow-lg space-x-4 rtl:space-x-reverse; }
    .audio-player button { @apply text-white bg-indigo-600 p-3 rounded-full hover:bg-indigo-700 transition-colors; }
    .audio-player button.playing { @apply bg-red-600 hover:bg-red-700; }
    .progress { @apply flex-1 h-1 bg-gray-400 rounded overflow-hidden relative cursor-pointer; }
    .progress .filled { @apply bg-indigo-500 h-full; }
    .time { @apply text-white text-sm w-16 text-center; }
    .mode-btn { @apply flex items-center justify-center space-x-2 rtl:space-x-reverse py-2 px-4 rounded-full font-medium transition-all; }
    .mode-btn.direct { @apply bg-indigo-600 text-white hover:bg-indigo-700 shadow-md; }
    .mode-btn.contact { @apply bg-teal-600 text-white hover:bg-teal-700 shadow-md; }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
  <div class="glass-container rounded-2xl shadow-2xl p-6 w-full max-w-lg">
    <!-- Header -->
    <div class="flex items-center justify-center mb-4">
      <i class="fas fa-university text-2xl text-blue-300 ml-2"></i>
      <h1 class="text-2xl font-bold text-white">Parsian <span class="text-blue-300">Voice</span></h1>
    </div>
    <!-- Main/Form Toggle -->
    <div class="flex mb-4">
      <button id="dasturBtn" class="flex-1 mx-1 py-2 rounded-xl bg-sky-600 text-white">دستور</button>
      <button id="formBtn" class="flex-1 mx-1 py-2 rounded-xl bg-sky-500 text-white">فرم</button>
    </div>
    <div id="formContainer" class="hidden p-4 bg-white/10 rounded-xl border border-white/20 fade-in">
      <!-- Form Content -->
    </div>
    <div id="mainContainer">
      <!-- Sub-mode Toggle -->
      <div class="flex justify-center mb-6 space-x-4 rtl:space-x-reverse">
        <button id="directModeBtn" class="mode-btn direct"><i class="fas fa-location-arrow"></i><span>مستقیم</span></button>
        <button id="contactModeBtn" class="mode-btn contact"><i class="fas fa-address-book"></i><span>از مخاطبین</span></button>
      </div>
      <!-- Controls -->
      <div class="flex flex-col items-center space-y-6 mb-6">
        <button id="recordButton" class="bg-blue-600 hover:bg-blue-700 text-white p-8 rounded-full shadow-lg transition-transform hover:scale-110">
          <i id="recordIcon" class="fas fa-microphone text-4xl"></i>
        </button>
        <button id="sendButton" disabled class="bg-green-500 hover:bg-green-600 text-white py-3 px-8 rounded-xl disabled:opacity-50 disabled:cursor-not-allowed flex items-center space-x-2">
          <i class="fas fa-paper-plane"></i><span>ارسال</span>
        </button>
      </div>
      <!-- Waveform -->
      <div id="waveform" class="hidden flex h-16 items-end justify-center gap-2 mb-6">
        <div class="wave-bar w-2 bg-gradient-to-b from-sky-200 to-sky-800 rounded-md"></div>
        <div class="wave-bar w-2 bg-gradient-to-b from-sky-200 to-sky-800 rounded-md"></div>
        <div class="wave-bar w-2 bg-gradient-to-b from-sky-200 to-sky-800 rounded-md"></div>
        <div class="wave-bar w-2 bg-gradient-to-b from-sky-200 to-sky-800 rounded-md"></div>
        <div class="wave-bar w-2 bg-gradient-to-b from-sky-200 to-sky-800 rounded-md"></div>
      </div>
      <!-- API Response -->
      <div id="apiResponse" class="hidden p-4 bg-white/10 rounded-2xl mb-6 fade-in">
        <h3 class="text-white font-semibold mb-2">پاسخ دستیار</h3>
        <p id="responseText" class="text-gray-100"></p>
        <audio id="responseAudio" controls class="hidden w-full mt-2"></audio>
      </div>
      <!-- Custom Audio Player -->
      <div id="audioPlayerContainer" class="hidden audio-player mb-6">
        <button id="playPause"><i class="fas fa-play"></i></button>
        <div class="progress" id="progressBar"><div class="filled" id="progressFilled"></div></div>
        <span class="time" id="currentTime">0:00</span>
      </div>
      <!-- History -->
      <div id="historyContainer" class="p-4 bg-white/10 rounded-2xl max-h-40 overflow-y-auto">
        <h3 class="text-white font-semibold mb-2">تاریخچه</h3>
        <div id="historyContent" class="space-y-2 text-gray-100"></div>
      </div>
    </div>
    <div class="text-center text-white text-xs mt-4">powered by caspian</div>
    <div id="statusToast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 text-white px-6 py-3 rounded-lg shadow-xl opacity-0"></div>
  </div>
  <script>
  document.addEventListener('DOMContentLoaded', () => {
    const recordButton = document.getElementById('recordButton'), recordIcon = document.getElementById('recordIcon');
    const playPause = document.getElementById('playPause');
    const progressBar = document.getElementById('progressBar'), progressFilled = document.getElementById('progressFilled');
    const currentTime = document.getElementById('currentTime');
    const audioPlayer = document.getElementById('audioPlayer');
    let mediaRecorder, audioChunks = [], audioBlob;// Play/Pause Logic
playPause.onclick = () => {
  if (audioPlayer.paused) { audioPlayer.play(); playPause.innerHTML = '<i class="fas fa-pause"></i>'; }
  else { audioPlayer.pause(); playPause.innerHTML = '<i class="fas fa-play"></i>'; }
};
audioPlayer.ontimeupdate = () => {
  const percent = audioPlayer.currentTime / audioPlayer.duration;
  progressFilled.style.width = (percent*100)+'%';
  const mins = Math.floor(audioPlayer.currentTime/60);
  const secs = Math.floor(audioPlayer.currentTime%60).toString().padStart(2,'0');
  currentTime.textContent = mins + ':' + secs;
};
progressBar.onclick = e => {
  const rect = progressBar.getBoundingClientRect();
  const clickX = e.clientX - rect.left;
  const newTime = (clickX / rect.width) * audioPlayer.duration;
  audioPlayer.currentTime = newTime;
};

// Recording Logic (simplified)
navigator.mediaDevices.getUserMedia({audio:true}).then(stream=> mediaRecorder=new MediaRecorder(stream));
recordButton.onclick = () => {
  if (mediaRecorder.state === 'recording') {
    mediaRecorder.stop();
    recordIcon.classList.replace('fa-stop','fa-microphone');
  } else {
    audioChunks = [];
    mediaRecorder.start();
    recordIcon.classList.replace('fa-microphone','fa-stop');
  }
};
mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
mediaRecorder.onstop = () => {
  audioBlob = new Blob(audioChunks, { type: 'audio/mp4' });
  audioPlayer.src = URL.createObjectURL(audioBlob);
  document.getElementById('audioPlayerContainer').classList.remove('hidden');
};

}); </script>

</body>
</html>