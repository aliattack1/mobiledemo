<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دستیار صوتی پارسیان</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%); }
        .glass-container { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239,68,68,0.8); } 70% { box-shadow: 0 0 0 20px rgba(239,68,68,0); } 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0); } }
        .recording-animation { animation: pulse 1.5s infinite; }
        .fade-in { animation:fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px);} to { opacity:1; transform:translateY(0);} }
        #statusToast { backdrop-filter: blur(8px); background: rgba(0,0,0,0.7); }
        /* JSON Output Styling */
        #jsonOutput { background: rgba(0,0,0,0.3); color: #fff; padding: 1rem; margin-top: 1rem; border-radius: 0.5rem; font-family: monospace; font-size: 0.875rem; max-height: 150px; overflow-y: auto; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
    <div>
        <div class="glass-container rounded-2xl shadow-2xl p-6 w-full max-w-lg">
            <!-- Header -->
            <div class="flex items-center justify-center mb-4">
                <i class="fas fa-university text-2xl text-blue-300 ml-2"></i>
                <h1 class="text-2xl font-bold text-white">Parsian <span class="text-blue-300">Voice</span></h1>
            </div>
            <!-- Mode Toggle -->
            <div class="flex mb-4">
                <button id="dasturBtn" class="flex-1 mx-1 py-2 rounded-xl bg-sky-600 text-white font-medium transition-all hover:bg-sky-700">دستور</button>
                <button id="formBtn" class="flex-1 mx-1 py-2 rounded-xl bg-sky-500 text-white font-medium transition-all hover:bg-sky-600">فرم</button>
            </div>
            <!-- Form Mode -->
            <div id="formContainer" class="hidden p-4 bg-white/10 rounded-xl border border-white/20 fade-in">
                <h2 class="text-xl font-semibold text-white mb-4">اطلاعات کاربر</h2>
                <form id="userForm" class="space-y-4">
                    <div>
                        <label for="fullName" class="block text-white mb-1">نام کامل</label>
                        <input type="text" id="fullName" name="fullName" placeholder="محمد رضایی" class="w-full p-2 rounded-lg bg-white/20 placeholder-gray-200 text-white focus:outline-none focus:ring-2 focus:ring-sky-400" required>
                    </div>
                    <div>
                        <label for="cardNumber" class="block text-white mb-1">شماره کارت</label>
                        <input type="text" id="cardNumber" name="cardNumber" placeholder="6037 9900 1234 5678" maxlength="19" class="w-full p-2 rounded-lg bg-white/20 placeholder-gray-200 text-white focus:outline-none focus:ring-2 focus:ring-sky-400" required>
                    </div>
                    <button type="submit" class="w-full py-3 rounded-xl bg-green-500 hover:bg-green-600 text-white font-semibold transition-transform transform hover:-translate-y-1">ارسال</button>
                </form>
                <div id="jsonOutput" class="hidden"></div>
            </div>
            <!-- Main Voice UI -->
            <div id="mainContainer">
                <!-- Permission Status -->
                <div id="permissionStatus" class="hidden mb-4 p-3 rounded-lg text-sm text-white bg-blue-500/20"></div>
                <!-- Waveform Card -->
                <div id="waveformCard" class="hidden bg-white/20 rounded-xl p-4 mb-4 fade-in">
                    <div id="waveform" class="flex h-16 items-end justify-center gap-2">
                        <div class="wave-bar bg-gradient-to-b from-sky-200

0 to-

document.getElementById('sendButton');

            let cardData = {};
            let contactMode = false;
            let mediaRecorder, audioChunks = [], audioBlob;
            let currentPath = 'maincommand';

            // Main Toggle
            dasturBtn.addEventListener('click', () => {
                formContainer.classList.add('hidden');
                mainContainer.classList.remove('hidden');
                dasturBtn.classList.replace('bg-sky-500','bg-sky-600');
                formBtn.classList.replace('bg-sky-600','bg-sky-500');
            });
            formBtn.addEventListener('click', () => {
                mainContainer.classList.add('hidden');
                formContainer.classList.remove('hidden');
                formBtn.classList.replace('bg-sky-500','bg-sky-600');
                dasturBtn.classList.replace('bg-sky-600','bg-sky-500');
            });

            // Sub Toggle: Direct / Contacts
            directModeBtn.addEventListener('click', () => {
                contactMode = false;
                directModeBtn.classList.replace('bg-gray-500','bg-indigo-600');
                contactModeBtn.classList.replace('bg-indigo-600','bg-gray-500');
            });
            contactModeBtn.addEventListener('click', () => {
                contactMode = true;
                contactModeBtn.classList.replace('bg-gray-500','bg-indigo-600');
                directModeBtn.classList.replace('bg-indigo-600','bg-gray-500');
            });
            directModeBtn.click();

            // Handle Form Submission
            userForm.addEventListener('submit', e => {
                e.preventDefault();
                const name = document.getElementById('fullName').value.trim();
                const card = document.getElementById('cardNumber').value.trim();
                if(name && card) {
                    cardData[name] = card;
                    jsonOutput.textContent = JSON.stringify(cardData, null, 2);
                    jsonOutput.classList.remove('hidden');
                    userForm.reset();
                }
            });

            // Recording logic
            recordButton.addEventListener('click', () => {
                if(mediaRecorder && mediaRecorder.state==='recording') {
                    stopRecording();
                } else {
                    startRecording();
                }
            });

            function startRecording(){
                navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
                    mediaRecorder=new MediaRecorder(stream);
                    audioChunks=[];
                    mediaRecorder.ondataavailable=e=>audioChunks.push(e.data);
                    mediaRecorder.onstop=()=>{
                        audioBlob=new Blob(audioChunks,{type:'audio/mp4'});
                        sendButton.disabled=false;
                    };
                    mediaRecorder.start();

                    // UI update
                    recordIcon.classList.replace('fa-microphone','fa-stop');
                    recordButton.classList.add('recording-animation','bg-red-600','hover:bg-red-700');
                    recordButton.classList.remove('bg-blue-600','hover:bg-blue-700');
                });
            }
            function stopRecording(){
                mediaRecorder.stop();
                // UI reset
                recordIcon.classList.replace('fa-stop','fa-microphone');
                recordButton.classList.remove('recording-animation','bg-red-600','hover:bg-red-700');
                recordButton.classList.add('bg-blue-600','hover:bg-blue-700');
            }

            // Send logic
            sendButton.addEventListener('click', ()=>{
                const formData=new FormData();
                formData.append('voice', audioBlob, 'recording.m4a');
                if(contactMode){
                    const blob=new Blob([JSON.stringify(cardData)],{type:'application/json'});
                    formData.append('datalist', blob, 'datalist.json');
                }
                let

url=`https://api.example.com/${currentPath}`;
                if(contactMode) url+= '/type/number';
                fetch(url,{method:'POST',body:formData})
                   .then(res=>{/* handle response */});
            });
        });
    </script>
</body>
</html>