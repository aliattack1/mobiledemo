<!DOCTYPE html><html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>دستیار صوتی پارسیان</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        body { background: linear-gradient(135deg, #1E3A8A 0%, #3B82F6 100%); }
        .glass-container { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(239,68,68,0.8); } 70% { box-shadow: 0 0 0 20px rgba(239,68,68,0); } 100% { box-shadow: 0 0 0 0 rgba(239,68,68,0); } }
        .recording-animation { animation: pulse 1.5s infinite; }
        .fade-in { animation:fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity:0; transform:translateY(10px);} to { opacity:1; transform:translateY(0);} }
        #statusToast { backdrop-filter: blur(8px); background: rgba(0,0,0,0.7); }
        #jsonOutput { background: rgba(0,0,0,0.3); color: #fff; padding: 1rem; margin-top: 1rem; border-radius: 0.5rem; font-family: monospace; font-size: 0.875rem; max-height: 150px; overflow-y: auto; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-6">
    <div>
        <div class="glass-container rounded-2xl shadow-2xl p-6 w-full max-w-lg">
            <div class="flex items-center justify-center mb-4">
                <i class="fas fa-university text-2xl text-blue-300 ml-2"></i>
                <h1 class="text-2xl font-bold text-white">Parsian <span class="text-blue-300">Voice</span></h1>
            </div>
            <div class="flex mb-4">
                <button id="dasturBtn" class="flex-1 mx-1 py-2 rounded-xl bg-sky-600 text-white font-medium hover:bg-sky-700">دستور</button>
                <button id="formBtn" class="flex-1 mx-1 py-2 rounded-xl bg-sky-500 text-white font-medium hover:bg-sky-600">فرم</button>
            </div>
            <div id="formContainer" class="hidden p-4 bg-white/10 rounded-xl border border-white/20 fade-in">
                <h2 class="text-xl font-semibold text-white mb-4">اطلاعات کاربر</h2>
                <form id="userForm" class="space-y-4">
                    <div><label for="fullName" class="block text-white mb-1">نام کامل</label><input type="text" id="fullName" name="fullName" placeholder="محمد رضایی" class="w-full p-2 rounded-lg bg-white/20 placeholder-gray-200 text-white focus:outline-none focus:ring-2 focus:ring-sky-400" required></div>
                    <div><label for="cardNumber" class="block text-white mb-1">شماره کارت</label><input type="text" id="cardNumber" name="cardNumber" placeholder="6037 9900 1234 5678" maxlength="19" class="w-full p-2 rounded-lg bg-white/20 placeholder-gray-200 text-white focus:outline-none focus:ring-2 focus:ring-sky-400" required></div>
                    <button type="submit" class="w-full py-3 rounded-xl bg-green-500 hover:bg-green-600 text-white font-semibold transition-transform transform hover:-translate-y-1">ارسال</button>
                </form>
                <div id="jsonOutput" class="hidden"></div>
            </div>
            <div id="mainContainer">
                <div id="permissionStatus" class="hidden mb-4 p-3 rounded-lg text-sm text-white bg-blue-500/20"></div>
                <div id="waveform" class="waveform hidden fade-in mb-4">
                    <div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div><div class="wave-bar"></div>
                </div>
                <div class="flex justify-center mb-4 space-x-4 rtl:space-x-reverse">
                    <button id="directModeBtn" class="px-4 py-2 bg-indigo-600 text-white rounded-full font-medium">مستقیم</button>
                    <button id="contactModeBtn" class="px-4 py-2 bg-gray-500 text-white rounded-full font-medium hover:bg-gray-600">از مخاطبین</button>
                </div>
                <div class="flex flex-col space-y-6">
                    <button id="recordButton" class="bg-blue-600 hover:bg-blue-700 text-white p-8 rounded-full flex items-center justify-center transition-colors mx-auto shadow-lg">
                        <i id="recordIcon" class="fas fa-microphone text-4xl"></i>
                    </button>
                    <button id="sendButton" disabled class="bg-green-500 hover:bg-green-600 text-white py-3 px-8 rounded-xl font-semibold flex items-center justify-center space-x-2 disabled:opacity-50 disabled:cursor-not-allowed shadow-md">
                        <i class="fas fa-paper-plane"></i><span>ارسال</span>
                    </button>
                    <div id="apiResponse" class="hidden mt-6 p-6 bg-white/10 rounded-xl border border-white/20 fade-in">
                        <h3 class="font-semibold text-white mb-3 text-lg">پاسخ دستیار</h3>
                        <div id="responseText" class="text-base text-gray-100 mb-3"></div>
                        <audio id="responseAudio" controls class="response-audio hidden"></audio>
                    </div>
                </div>
                <div id="audioPlayerContainer" class="hidden mt-6 fade-in">
                    <audio id="audioPlayer" controls class="w-full rounded-lg"></audio>
                </div>
                <div id="historyContainer" class="mt-8 p-6 bg-white/10 rounded-xl max-h-40 overflow-y-auto">
                    <h3 class="text-lg font-semibold text-white mb-3">تاریخچه فرمان‌ها</h3>
                    <div id="historyContent" class="space-y-3"></div>
                </div>
            </div>
        </div>
        <div class="text-center text-white text-xs mt-3">powered by caspian</div>
    </div>
    <div id="statusToast" class="fixed bottom-6 left-1/2 transform -translate-x-1/2 text-white px-6 py-3 rounded-lg shadow-xl opacity-0 transition-opacity duration-300"></div>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Element references
            const dasturBtn = document.getElementById('dasturBtn');
            const formBtn = document.getElementById('formBtn');
            const mainContainer = document.getElementById('mainContainer');
            const formContainer = document.getElementById('formContainer');
            const userForm = document.getElementById('userForm');
            const jsonOutput = document.getElementById('jsonOutput');
            const directModeBtn = document.getElementById('directModeBtn');
            const contactModeBtn = document.getElementById('contactModeBtn');
            const recordButton = document.getElementById('recordButton');
            const recordIcon = document.getElementById('recordIcon');
            const sendButton = document.getElementById('sendButton');
            const audioPlayerContainer = document.getElementById('audioPlayerContainer');
            const audioPlayer = document.getElementById('audioPlayer');
            const waveform = document.getElementById('waveform');
            const waveBars = waveform.querySelectorAll('.wave-bar');
            const permissionStatus = document.getElementById('permissionStatus');
            const historyContent = document.getElementById('historyContent');
            const apiResponse = document.getElementById('apiResponse');
            const responseText = document.getElementById('responseText');
            const responseAudio = document.getElementById('responseAudio');
            const statusToast = document.getElementById('statusToast');// State
        let cardData = {};
        let contactMode = false;
        let mediaRecorder, audioChunks = [], audioBlob;
        let currentPath = 'maincommand';
        let resultsHistory = [];
        let animationInterval;

        // Utilities
        function showToast(message, type) {
            statusToast.textContent = message;
            statusToast.classList.remove('bg-gray-800','bg-green-500','bg-red-500','bg-blue-500');
            statusToast.classList.add(type==='success'?'bg-green-500':type==='error'?'bg-red-500':'bg-blue-500');
            statusToast.classList.replace('opacity-0','opacity-100');
            setTimeout(()=>statusToast.classList.replace('opacity-100','opacity-0'),3000);
        }
        function animateWaveform() {
            animationInterval = setInterval(()=>{
                waveBars.forEach(bar => bar.style.height = (Math.floor(Math.random()*60)+10) + 'px');
            },100);
        }
        function resetApiPath(){ currentPath='maincommand'; }
        function addResultToHistory(text){
            resultsHistory.push(text);
            const item = document.createElement('div');
            item.className='bg-white/20 p-3 rounded-lg text-gray-100 text-sm fade-in';
            item.textContent = text;
            historyContent.prepend(item);
        }
        function checkMicrophonePermission(){
            navigator.mediaDevices.getUserMedia({audio:true})
              .then(stream=>{ stream.getTracks().forEach(t=>t.stop()); permissionStatus.className='mb-4 p-3 rounded-lg text-sm text-white bg-green-500/20'; permissionStatus.textContent='میکروفن فعال است'; })
              .catch(()=>{ permissionStatus.className='mb-4 p-3 rounded-lg text-sm text-white bg-red-500/20'; permissionStatus.textContent='دسترسی میکروفن رد شد'; recordButton.disabled=true; });
            permissionStatus.classList.remove('hidden');
        }

        // Main Toggles
        dasturBtn.addEventListener('click',()=>{ formContainer.classList.add('hidden'); mainContainer.classList.remove('hidden'); dasturBtn.classList.replace('bg-sky-500','bg-sky

Explain expected behavior.

